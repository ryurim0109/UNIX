## 4장 파일과 디렉터리

> stat, fstat, fstatat, lstat함수

- stat함수는 pathname인수로 지정된 파일에 대한 정보를 한 구조체에 담아서 돌려줌.
- fstat함수는 fd인수로 지정된 파일 서술자에 대해 이미 열려 있는 파일에 관한 정보를 돌려줌.
- lstat함수는 stat과 비슷하되 기호 링크에 대한 정보를 돌려줌.(기호 링크에 대한 정보)
  -fstatat함수는 fd인수로 지정된 파일 서술자에 대해 해당하는 열린 디렉터리를 기준으로 한 상대 경로에 관한 파일 통계치를 돌려줌. (flag에 따라 stat or lstat처럼 행동함)

> 파일 종류

- 정규파일 : 가장 흔한 종류의 파일, 어떤 형태이든 자료를 담음. 유닉스 커널은 텍스트 자료와 이진 자료를 구분하지 않음. 해석하는 건 응용 프로그램의 몫.
- 디렉터리 파일 : 다른 파일들의 이름과 그 파일들에 대한 정보로의 포인터들을 담은 파일, 디텔터리 파일에 대한 읽기 권한을 가진 모든 프로세스는 그 디렉터리의 내용물도 읽을 수 있으나 디렉터리 파일에 직접 쓸 수 있는 것은 커널뿐임.
- 블록 특수 파일 : 디스크 드라이브 같은 장치에 대해 고정 크기 단위 버퍼링 있는 입출력 접근을 제공하는 파일
- 문자 특수 파일 : 장치에 대한 가변 크기 단위의 버퍼링 없는 입출력 접근을 제공하는 파일, 한 시스템의 모든 장치는 블록 특수 파일 아니면 문자 특수 파일임
- FIFO : 프로세스들 사이의 통신에 쓰이는 파일, 명명된 파이프라고도 부른다.
- 소켓 : 프로세스들 사이의 네트워크 통신에 쓰이는 파일, 하나의 호스트 안에 있는 프로세스들 사이의 비 네트워크 통신에 소켓을 사용할 수 있음
- 기호 링크 : 다른 파일을 가리키는 파일

<sys/stat.h>의 파일 종류 식별 매크로들
| 매크로 | 설명 |
|--------|------|
| S_ISREG(m) | 일반 파일인지 확인 |
| S_ISDIR(m) | 디렉토리인지 확인 |
| S_ISCHR(m) | 문자 장치인지 확인 |
| S_ISBLK(m) | 블록 장치인지 확인 |
| S_ISFIFO(m) | FIFO(파이프)인지 확인 |
| S_ISLNK(m) | 심볼릭 링크인지 확인 |
| S_ISSOCK(m) | 소켓인지 확인 |

<sys/stat.h>의 IPC 종류 식별 매크로들
| 매크로 | 설명 |
| -------------- | ----------------------------------- |
| S_TYPEISMQ() | 메시지 큐(Message Queue)인지 확인 |
| S_TYPEISSEM() | 세마포어(Semaphore)인지 확인 |
| S_TYPEISSHM() | 공유 메모리(Shared Memory)인지 확인 |

> 사용자 ID 설정 비트와 그룹 ID 설정 비트

|                                          |                                               |
| ---------------------------------------- | --------------------------------------------- |
| 실제 사용자 ID 실제 그룹ID               | 사용자나 그룹이 실제로 누구인지 알려주는 ID들 |
| 유효 사용자 ID 유효그룹 ID 추가그룹 ID들 | 파일 접근 권한 점검에 쓰임                    |
| 저장된 사용자 ID 저장된 그룹 ID          | exec류 함수들이 저장함                        |

- 모든 파일에는 소유자와 그룹 소유자가 있다. 소유자는 stat 구조체의 st_uid 멤버로 지정되고, 그룹 소유자는 st_gid 멤버로 지정된다.
- 사용자 ID 설정 비트와 그룹 ID설정 비트는 파일의 st_mode값에 들어있다. 이 두 비트를 판정할 때에는 상수 S_ISUID나 S_ISGID를 사용함.

> 파일 접근 권한

- st_mode 값에는 파일에 대한 접근 권한 비트들도 부호화되어 있다. 파일 > 모든 파일포함.
  | 매크로 | 8진수 값 | 설명 |
  |--------|---------|------|
  | S_IRUSR | 0400 | 사용자(소유자) 읽기 |
  | S_IWUSR | 0200 | 사용자(소유자) 쓰기 |
  | S_IXUSR | 0100 | 사용자(소유자) 실행 |
  | S_IRGRP | 0040 | 그룹 읽기 |
  | S_IWGRP | 0020 | 그룹 쓰기 |
  | S_IXGRP | 0010 | 그룹 실행 |
  | S_IROTH | 0004 | 기타 읽기 |
  | S_IWOTH | 0002 | 기타 쓰기 |
  | S_IXOTH | 0001 | 기타 실행 |

> 새 파일과 디렉터리의 소유권

1. 프로세스의 유효 그룹 ID를 새 파일의 그룹ID로 사용한다.
2. 파일이 생성된 디렉터리의 그룹 ID를 새 파일의 그룹 ID로 사용한다.
